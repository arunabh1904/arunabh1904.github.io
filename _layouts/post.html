<!-- _layouts/post.html -->
<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    {% include head.html %}
    <link rel="stylesheet" href="/css/override.css">
    <!-- override.css is where you can define custom styling -->
  </head>
  <body{% if page.editor_theme %} class="editor-theme"{% endif %}>
    <!-- Dark/Light Toggle Button -->
    <button
      type="button"
      id="theme-toggle"
      class="small-rounded-button"
      aria-label="Toggle theme"
    >
      <i class="fas fa-sun"></i>
    </button>

    <!-- Button to Go Back/Home with an arrow -->
    <button type="button" id="home-button" class="small-rounded-button">
      <i class="fas fa-arrow-left"></i>
    </button>

    <button type="button" id="music-button" class="small-rounded-button">
      <i class="fas fa-music"></i>
      Play some music while browsing...
    </button>
    <div id="music-bar"></div>

    <main class="page-content" style="max-width:800px; margin:2rem auto;">
      {{ content }}
    </main>

    <script>
      const STORAGE_KEY = 'theme';
      const toggleButton = document.getElementById('theme-toggle');
      const html = document.documentElement;

      function applySavedTheme() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved === 'light' || saved === 'dark') {
          html.setAttribute('data-theme', saved);
        }
      }

      function updateToggleIcon() {
        if (html.getAttribute('data-theme') === 'dark') {
          toggleButton.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
          toggleButton.innerHTML = '<i class="fas fa-moon"></i>';
        }
      }

      applySavedTheme();
      updateToggleIcon();

      toggleButton.addEventListener('click', () => {
        const newTheme = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', newTheme);
        localStorage.setItem(STORAGE_KEY, newTheme);
        updateToggleIcon();
      });

      // Go Home
      const homeButton = document.getElementById('home-button');
      homeButton.addEventListener('click', () => {
        window.location.href = '/';
      });

    </script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        function linkify(headerId) {
          const header = document.getElementById(headerId);
          if (!header) return;
          const list = header.nextElementSibling;
          if (!list || !(list.tagName === 'OL' || list.tagName === 'UL')) return;
          if (list.querySelector('a')) return;

          const items = Array.from(list.children);
          const targets = [];
          let el = list.nextElementSibling;
          while (el) {
            if (/^H[1-6]$/.test(el.tagName)) targets.push(el);
            if (targets.length === items.length) break;
            el = el.nextElementSibling;
          }

          items.forEach((li, i) => {
            const target = targets[i];
            if (!target) return;
            const text = li.textContent.trim();
            li.innerHTML = `<a href="#${target.id}">${text}</a>`;
          });
        }

        linkify('lecture-outline');
        linkify('table-of-contents');
      });
    </script>
      <script src="/assets/js/music-launcher.js"></script>
    </body>
  </html>
